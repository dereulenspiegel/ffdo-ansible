---
# tasks file for supernode-interfaces

- name: Install supernode specific sysctl config
  template: src=supernode.sysctl.j2 dest=/etc/sysctl.d/supernode.conf
  register: supernode_sysctl_installed

- name: Load sysctl variables
  when: supernode_sysctl_installed|changed
  shell: sysctl -p /etc/sysctl.d/supernode.conf || true

- name: Ensure interface definitions from other files are included
  lineinfile:
    dest: /etc/network/interfaces
    line: "source /etc/network/interfaces.d/*.cfg"

- name: Install interface definitions
  template:
    dest: "/etc/network/interfaces.d/{{item.file}}"
    src: "{{item.template}}"
  with_items:
  - file: peering.cfg
    template: peering_interfaces.j2

- name: Install bird.conf
  template: src=bird.conf.j2 dest=/etc/bird.d/peering.conf
  notify: Restart bird daemons

- name: Install bird6.conf
  template: src=bird6.conf.j2 dest=/etc/bird6.d/peering6.conf
  notify: Restart bird daemons